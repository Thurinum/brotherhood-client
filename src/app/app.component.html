<!-- HEADER -->
<header>
	<h1>IntelliBrotherhood&trade; Contract Manager 2022</h1>
	<div class="auth">
		<button *ngIf="!isLoggedIn" mat-raised-button color="primary" (click)="state = AppState.Login">
			<mat-icon>account_circle</mat-icon>&nbsp;
			<mat-label>Log in</mat-label>
		</button>
		<button *ngIf="!isLoggedIn" mat-stroked-button color="primary" (click)="state = AppState.Register">
			<mat-icon>account_circle</mat-icon>&nbsp;
			<mat-label>Sign up</mat-label>
		</button>
		<button *ngIf="isLoggedIn" mat-raised-button color="primary" (click)="logout()">
			<mat-icon>vpn_key</mat-icon>&nbsp;
			<mat-label>Log out</mat-label>
		</button>
	</div>
</header>

<br />

<main>
	<!-- PRIMARY CONTENT -->
	<mat-tab-group mat-align-tabs="center" [@form-animation]>
		<mat-tab>
			<ng-template mat-tab-label>
				<span class="tab-label" (click)="showUserContracts = false; refreshContracts()">
					<mat-icon>public</mat-icon>&nbsp;Public Contracts
				</span>
			</ng-template>
			<app-contract-list [contracts]="contracts" [canAdd]="isLoggedIn" (refresh)="refreshContracts()"
						 (select)="selectContract($event)" (add)="state = AppState.CreateContract;refreshCities()"
						 (remove)="nukeContract($event)"></app-contract-list>
		</mat-tab>
		<mat-tab *ngIf="isLoggedIn">
			<ng-template mat-tab-label>
				<span class="tab-label" (click)="showUserContracts = true; refreshContracts()">
					<mat-icon>lock</mat-icon>&nbsp;My Contracts
				</span>
			</ng-template>
			<app-contract-list [contracts]="contracts" [canAdd]="isLoggedIn" (refresh)="refreshContracts()"
						 (select)="selectContract($event)" (add)="state = AppState.CreateContract;refreshCities()"
						 (remove)="nukeContract($event)"></app-contract-list>
		</mat-tab>
		<mat-tab>
			<ng-template mat-tab-label>
				<span class="tab-label">
					<mat-icon>person_outline</mat-icon>&nbsp;Targets
				</span>
			</ng-template>
			<app-contract-target-list [targets]="targets"></app-contract-target-list>
		</mat-tab>
		<mat-tab label="Cities">
			<ng-template mat-tab-label>
				<span class="tab-label">
					<mat-icon>location_city</mat-icon>&nbsp;Cities
				</span>
			</ng-template>
			<app-city-list [cities]="cities"></app-city-list>
		</mat-tab>
	</mat-tab-group>

	<!-- SECONDARY CONTENT -->
	<app-contract-details *ngIf="selectedContract" [model]="selectedContract" (share)="state = AppState.ShareContract"
				    (addTarget)="state = AppState.AddContractTarget"></app-contract-details>
</main>

<!-- MODAL DIALOGS -->
<section class="form-panel" *ngIf="state != AppState.None" [@form-animation]>
	<button class="form-close" mat-mini-fab color="primary" (click)="state = AppState.None">
		<mat-icon>close</mat-icon>
	</button>

	<ng-container [ngSwitch]="state">
		<app-form-login *ngSwitchCase="AppState.Login" (login)="refreshContracts()"></app-form-login>
		<app-form-register *ngSwitchCase="AppState.Register"></app-form-register>
		<app-form-contract-upsert *ngSwitchCase="AppState.CreateContract" [cities]="cities" (create)="refreshContracts()"></app-form-contract-upsert>
		<app-form-contract-share *ngSwitchCase="AppState.ShareContract" [contract]="selectedContract"></app-form-contract-share>
		<app-form-contract-target-add *ngSwitchCase="AppState.AddContractTarget" [contract]="selectedContract" [contractTargets]="targets" (add)="this.selectContract(selectedContract!)"></app-form-contract-target-add>
		<app-form-contract-target-upsert *ngSwitchCase="AppState.EditContractTarget" [target]="selectedTarget"></app-form-contract-target-upsert>
	</ng-container>
</section>

<br />

<!-- FOOTER -->
<footer class="legal">
	<mat-divider></mat-divider>
	<p><small>&copy; 2022 JuliePro LLC - v1.4</small></p>
</footer>
