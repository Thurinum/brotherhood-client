<header>
	<h1>IntelliBrotherhood&trade; Contract Manager 2022</h1>
	<div class="auth">
		<button *ngIf="!isLoggedIn" mat-raised-button color="primary" (click)="state = FormState.Login">
			<mat-icon>account_circle</mat-icon>&nbsp;
			<mat-label>Log in</mat-label>
		</button>
		<button *ngIf="!isLoggedIn" mat-stroked-button color="primary" (click)="state = FormState.Register">
			<mat-icon>account_circle</mat-icon>&nbsp;
			<mat-label>Sign up</mat-label>
		</button>
		<button *ngIf="isLoggedIn" mat-raised-button color="primary" (click)="logout()">
			<mat-icon>vpn_key</mat-icon>&nbsp;
			<mat-label>Log out</mat-label>
		</button>
	</div>
</header>

<br />

<nav mat-tab-nav-bar [tabPanel]="tabPanel">
	<a mat-tab-link
	   (click)="showUserContracts = false; refreshContracts()"
	   [active]="!showUserContracts">Public Contracts</a>
	<a *ngIf="isLoggedIn" mat-tab-link
	   (click)="showUserContracts = true; refreshContracts()"
	   [active]="showUserContracts">My Contracts</a>
</nav>
<mat-tab-nav-panel #tabPanel>
	<app-contract-list [model]="contracts"
				 [canAdd]="isLoggedIn"
				 (refresh)="refreshContracts()"
				 (select)="selectContract($event)"
				 (add)="state = FormState.AddContract;refreshCities()"
				 (remove)="nukeContract($event)"></app-contract-list>
</mat-tab-nav-panel>

<app-contract-details *ngIf="selectedContract"
			    [model]="selectedContract"
			    (share)="state = FormState.AddContractOwner"
			    (addTarget)="state = FormState.AddContractTarget"></app-contract-details>

<br />
<mat-divider></mat-divider>
<p class="legal"><small>&copy; 2022 JuliePro LLC - v1.4</small></p>

<section class="form-panel" *ngIf="state != FormState.None" [@form-animation]>
	<button class="form-close" mat-mini-fab color="primary" (click)="state = FormState.None">
		<mat-icon>close</mat-icon>
	</button>

	<fieldset *ngIf="state == FormState.Login" [@zoom-animation]>
		<legend>Login</legend>
		<mat-form-field>
			<mat-label>Username or Email</mat-label>
			<input #loginUsername matInput type="text" placeholder="What's your identifier?" />
		</mat-form-field>
		<mat-form-field>
			<mat-label>Password</mat-label>
			<input #loginPassword matInput type="password" placeholder="What's your password?" />
		</mat-form-field>
		<button mat-raised-button color="primary" (click)="login(loginUsername.value, loginPassword.value)">
			<mat-icon>account_circle</mat-icon>
			Login
		</button>
	</fieldset>

	<fieldset *ngIf="state == FormState.Register" [@zoom-animation]>
		<legend>Sign up</legend>
		<mat-form-field>
			<mat-label>Username</mat-label>
			<input #registerUsername matInput type="text" placeholder="What's your identifier?" />
			<mat-hint>ID provided by the .</mat-hint>
		</mat-form-field>
		<mat-form-field>
			<mat-label>E-mail address</mat-label>
			<input #registerEmail matInput type="email" placeholder="What's your e-mail?" />
			<mat-hint>Don't use your personal e-mail.</mat-hint>
		</mat-form-field>
		<mat-form-field>
			<mat-label>Password</mat-label>
			<input #registerPassword matInput type="password" placeholder="What's your password?" />
			<mat-hint>At least 5 characters.</mat-hint>
		</mat-form-field>
		<mat-form-field>
			<mat-label>Confirm password</mat-label>
			<input #registerPasswordConfirm matInput type="password" placeholder="Repeat your password" />
		</mat-form-field>
		<button mat-raised-button color="primary"
			  (click)="register(registerUsername.value, registerEmail.value, registerPassword.value, registerPasswordConfirm.value)">
			<mat-icon>account_circle</mat-icon>
			Sign up
		</button>
	</fieldset>

	<fieldset *ngIf="state == FormState.AddContract" [@zoom-animation] [style.width.px]=300>
		<legend>Create a contract</legend>
		<mat-form-field>
			<mat-label>Codename</mat-label>
			<input #addContractName matInput type="text" placeholder="Enter contract name..." />
			<mat-hint>You will be able to assign assassins to the contract.</mat-hint>
		</mat-form-field>
		<mat-form-field [style.top.px]=12>
			<mat-label>Briefing</mat-label>
			<textarea #addContractDescription matInput maxlength="300" [style.height.px]=150 placeholder="Enter contract briefing..."></textarea>
			<mat-hint align="end">{{addContractDescription.value.length}}/300</mat-hint>
		</mat-form-field>
		<mat-form-field>
			<mat-label>Location</mat-label>
			<mat-select #addContractCity placeholder="Choose location...">
				<mat-option *ngFor="let city of cities" [value]="city">
					<mat-icon [style.border-radius.px]=50><img [src]="city.image"></mat-icon>
					{{ city.name }}
				</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field [style.top.px]=-23>
			<input matInput hidden />
			<mat-checkbox #addContractIsPublic color="primary">Public contract</mat-checkbox>
			<mat-hint>Can be picked up by any assassin.</mat-hint>
		</mat-form-field>
		<button mat-raised-button color="primary"
			  (click)="addContract(addContractName.value, addContractDescription.value, addContractCity.value, addContractIsPublic.checked)">
			<mat-icon>check</mat-icon>
			Register
		</button>
	</fieldset>

	<fieldset *ngIf="state == FormState.AddContractOwner && isLoggedIn">
		// TODO: Admins can add owners directly
		<legend>Request backup for {{selectedContract?.codename}}</legend>
		<mat-form-field>
			<mat-label>Username or email</mat-label>
			<input #addContractOwnerName matInput type="text" placeholder="Enter assassin identifier..." />
			<mat-hint>The assassin attempt to come to your aid.</mat-hint>
		</mat-form-field>
		<br />
		<button mat-raised-button color="primary"
			  (click)="addContractAssassin(addContractOwnerName.value, selectedContract)">
			<mat-icon>check</mat-icon>
			Send help request
		</button>
	</fieldset>

	<fieldset *ngIf="state == FormState.AddContractTarget">
		<legend>Add a target to {{selectedContract?.codename}}</legend>
		<mat-form-field>
			<mat-label>Target</mat-label>
			<mat-select #addContractTarget placeholder="Choose a target...">
				<mat-option *ngFor="let target of targets" [value]="target">
					<mat-icon [style.border-radius.px]=50>add</mat-icon>
					{{ target.firstName }} {{target.lastName}}
				</mat-option>
			</mat-select>
		</mat-form-field>
		<br />
		<button mat-raised-button color="primary" (click)="addTargetToContract(addContractTarget.value)">
			<mat-icon>check</mat-icon>
			Add target
		</button>
	</fieldset>
</section>
